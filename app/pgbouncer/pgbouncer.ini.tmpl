[databases]
*=user={role} password={password} host={host} port=5432 dbname={database} 

[pgbouncer]
listen_addr = 0.0.0.0
listen_port = 6432
auth_type = md5
auth_file = /etc/pgbouncer/userlist.txt

# Performance optimized pooling mode - transaction mode for better ORM compatibility
pool_mode = transaction
max_client_conn = 200
# Pool sizes optimized for Neon serverless - allow scaling to zero
default_pool_size = 25
# Allow all connections to close for Neon scale-to-zero
min_pool_size = 0
reserve_pool_size = 5

# SSL configuration
client_tls_sslmode = prefer
client_tls_cert_file = /etc/pgbouncer/server.crt
client_tls_key_file = /etc/pgbouncer/server.key
server_tls_sslmode = verify-full

# Performance tuning - using only supported parameters
server_connect_timeout = 15
query_timeout = 60
query_wait_timeout = 120
client_idle_timeout = 0
# 5 minutes - close server connections before Neon scales down
server_idle_timeout = 300

# Moderate logging for Neon scale-to-zero monitoring
# Log connections to monitor database wake-ups
log_connections = 1
# Log disconnections to monitor scale-down behavior  
log_disconnections = 1
log_pooler_errors = 1
# Disable stats and verbose logging to prevent startup issues
log_stats = 0
verbose = 0

# Optimized startup parameters
ignore_startup_parameters = extra_float_digits, application_name
server_reset_query = DISCARD ALL